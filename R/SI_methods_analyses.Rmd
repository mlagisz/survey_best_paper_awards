---
title: "SI_methods_analyses"
author: "ML"
date: "03/08/2023"
output:
  html_document: 
   toc: true
   toc_depth: 3
   number_sections: true
   theme: united
   highlight: tango
  word_document: 
   toc: true
   toc_depth: 3
   number_sections: true
   highlight: tango
format:
  html:
    embed-resources: true
editor_options:
  chunk_output_type: console
---

Note: project github page: https://github.com/mlagisz/survey_best_paper_awards


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(here)
library(DT)
library(ggimage)
library(ggcharts)
library(scales)
library(readxl)
library(kableExtra)
library(forcats)
library(ggupset)
library(patchwork)
library(stringr)
library(ggbeeswarm)
library(tidytext) #text processing
library(stopwords) #text processing
library(tokenizers) #text processing
library(ggwordcloud) #wordclouds
library(lme4) #linear models
#library(reports) #for model reporting
library(sjPlot) #for tab_model reporting

## set a plotting theme
theme_set(theme_classic(base_size = 14) + 
            theme(panel.background = element_blank(), 
                  plot.background = element_blank(), 
                  legend.background = element_blank(), 
                  text = element_text(colour = "white")))

#check oout other themes: https://r-charts.com/ggplot2/themes/
# library(ggthemr)
# ggthemr("solarized")
# ggthemr("freshe")
# ggthemr("pale")
 #call ggthemr_reset() #to reset to the default ggplot2 theme
```


Load Scimago Subject Area -level data set and associated meta-data table.

```{r}
# accessing all the sheets 
#sheet_names <- excel_sheets(here("data", "scimagojr 2021  Subject Areas.xlsx"))
sheet_names <- excel_sheets(here("data", "scimagojr 2021  Subject Areas_screening.xlsx"))
sheet_names <- sheet_names[-1]#remove first sheet with meta-data
SA_list_all <- lapply(sheet_names, function(x) {as.data.frame(read_excel(here("data", "scimagojr 2021  Subject Areas.xlsx"), sheet = x))}) #read all sheets to list
names(SA_list_all) <- sheet_names  #rename list elements 
#lapply(SA_list_all, names) #extract column names
#View(do.call(rbind, lapply(SA_list_all, names))) #View all column names as a table
#unique(do.call(rbind, lapply(SA_list_all, names))) #making sure all have same column names
SAdata <- do.call(rbind, SA_list_all)
#str(SAdata) #one large data frame
#names(SAdata)
names(SAdata) <- gsub(" ","_", names(SAdata)) #change spaces to _ in the column names
names(SAdata) <- gsub("\\.","", names(SAdata)) #remove . the column names
#dim(SAdata)
SAdata <- SAdata %>% drop_na(Subject_area)
#table(is.na(SAdata$Title)) #no empty journal names

SAmeta <- read_excel(here("data", "scimagojr 2021  Subject Areas_screening.xlsx"), sheet = 1, skip = 1) #load Scimago SA meta-data
#dim(SAmeta)
#names(SAmeta)
```

Load award-level data set and associated meta-data table.

```{r}
#BP load and prepare award-level meta-data
BPmeta <- read_excel(here("data", "Survey-Best_paper_awards (Responses)_SHAREDCOPY_checked.xlsx"), sheet = 2, skip = 1) #load main award #BPmeta <- read_excel("./data/Survey-Best_paper_awards (Responses)_SHAREDCOPY_checked.xlsx", sheet = 2, skip = 1) #load main award meta-data
#dim(BPmeta)
#names(BPmeta)

## load and prepare main extracted award-level data
BPdata <- read_excel(here("data","Survey-Best_paper_awards (Responses)_SHAREDCOPY_checked.xlsx"), sheet = 1) #load main award data
#BPdata <- read_excel("./data/Survey-Best_paper_awards (Responses)_SHAREDCOPY_checked.xlsx", sheet = 1) #load main award data
#dim(BPdata)
#names(BPdata)

#BPdata <- select(BPdata, !starts_with("...") ) #remove last few empty columns
#BPdata_orig_colnames <- names(BPdata) #store original column names
#BPdata$Award_name <- gsub("^The ", "", BPdata$Award_name) #remove "The" at the beginning of award names
names(BPdata) <- gsub(" ","_", names(BPdata)) #change spaces to _ in the column names

#rename selected data columns
BPdata <- BPdata %>% 
rename(Extractor_name = "Name_of_the_extracting_person",
       Award_name = "Full_name_of_the_award", 
       Journal_name = "Full_name_of_the_awarding_journal", 
       Award_description = "Paste_the_information_text_describing_the_award", 
       Eligible = "Confirm_eligibility_of_the_award",
       Awarding_journal = "Full_name_of_the_awarding_journal",
       Awarding_society = "Full_name_of_the_awarding_society",
       Awarding_other = "Full_name_of_the_awarding_publisher/other_body",  
       Career_stage = "Target_career_stage_of_eligible_applicants",
       Flexible_eligibility = "Flexibility_of_the_eligibility_criteria", 
       Assessors_transparency = "Assessor_transparency", 
       Open_science = "Valuing_Open_Science",  
       Self_nomination = "Self-nomination_allowed"
       )
#names(BPdata)

##check for rows with empty "Scimago Subject Area" values
table(is.na(BPdata$Scimago_Subject_Area)) #4 rows from pilot screening

##remove rows with pilot extractions and empty "Scimago Subject Area" values
BPdata <- BPdata[!is.na(BPdata$Scimago_Subject_Area), ]

#remove awards that were duplicate-extracted and excluded at extraction stages
BPdata <- BPdata[BPdata$Row_excluded == 0, ]
dim(BPdata) #223 rows left

##NOTE: total of 41 rows were removed as duplicates: 18 awards were doubly- or triply- extracted (total 18 out of 223 = 8%)

#create new variable for awards with description or without
BPdata$Descr_available <- fct_collapse(BPdata$Open_science,
  available = c("no", "yes"),
  "not available" = "not available"
)
```

Load winners-level data set and associated meta-data table.

```{r}
#load individual winnersdata
BPindiv <- read_csv(here("data", "BP_awards_lists_SHAREDCOPY - indiv_winners_20230717.csv"), skip = 1) #load individual winners data
#dim(BPindiv)
#names(BPindiv)

#load individual winners meta-data
BPindiv_meta <- read_csv(here("data", "BP_awards_lists_SHAREDCOPY - indiv_winners_meta-data.csv"), skip = 1) #load individual winners data
#dim(BPindiv_meta)
#names(BPindiv_meta)
```

Load country-level productivity SCImago data set and create associated meta-data table.

```{r}
#load SCImago 2021 country productivity (documents) data downloaded from https://www.scimagojr.com/countryrank.php?year=2021&min=0&min_type=it
COprod <- read_csv(here("data", "scimagojr country rank 2021.csv"), skip = 0) #load data
#dim(COprod)
#names(COprod)

#create meta-data with columns: 		data type [options]
COprod_meta <- tibble("column name" = names(COprod), 
                      "description" = c("Rank of a given country across all Scimago Subject Areas.",
                                        "Country name.",
                                        "Country location classification into one of the eight SCImago Major World Regions.",
                                        "Number of documents associated with a goven country published in 2021.",
                                        "Number of citable documents associated with a goven country published in 2021.",
                                        "Number of citations to documents associated with a goven country published in 2021.",
                                        "Number of self-citations to documents associated with a goven country published in 2021.",
                                        "Number of citations per document associated with a goven country published in 2021.",
                                        "H index of a country in 2021." ),
                      "data type [options]" = c("integer",
                                                "free text",
                                                "free text",
                                                "integer",
                                                "integer",
                                                "integer",
                                                "integer",
                                                "numeric",
                                                "integer"
                                                ))
#dim(COprod_meta)
#names(COprod_meta)
```




# Supplementary Methods

## Project workflow.    


![project workflow](../BP_awards_workflow_v1.png){#id .class width = 50% height = 50%}.  
Figure S1.    
**Figure S1. project workflow.**.     

### Award inclusion criteria
These criteria wer used to increase data consistency and improve comparisons across disciplines:
We will only include awards for a single published research contribution in a format of a research article (theses / dissertations are allowed if published as a journal article).
Awards must be managed by a journal, publisher, or a learned society.
We will exclude awards that are discontinued, and awards that are restricted to applicants from underrepresented groups, e.g., women-only / minorities-only awards.


### Screening
 If some of these awards get excluded during data extraction, we will return to the screening stage for that subject area to find replacement awards until we have 10 awards that are eligible for inclusion, or we run out of journals to screen.

·   	During screening, we will see if journals note “best paper” awards on their websites, and if not, we will check if journals are run by learned societies. If so, we will check if a learned society awards a “best paper” prize that fits in a given subject area being assessed. If a society awards multiple relevant awards in journals in the same subject area, we will choose one for a highest-ranked journal, or that appears to be most prestigious (e.g., with highest monetary value, oldest).
·   	If less than 10 awards are found for a subject area, we will also check websites of large and reputable publishers to see if they list any relevant “best paper” awards in a given subject area.
·   	For each subject area, we will collate a maximum of 10 awards that meet our selection criteria for data extraction.



## Characterise SCImago Subject Area (SA) journal lists and screening data.   

### Number of journals per SCImago Subject Area

```{r}
##count journals per SA
# count_j_perSA <- SAdata %>%
#     count(Subject_area) %>%
#     arrange(desc(n)) 

#table(SAdata$Subject_area)
#min(table(SAdata$Subject_area))
#max(table(SAdata$Subject_area))

#all SA as a simple barplot
SAdata %>% 
  #filter(!is.na(Subject_area)) %>% 
  count(Subject_area) %>%
  arrange(Subject_area) %>%
  ggplot(aes(x = reorder(Subject_area, desc(Subject_area)), y = n)) +
  geom_bar(stat = "identity", position = position_dodge(0.9)) +
  coord_flip()
```
#### Figure S2. 
*Counts of journal Titles per SCImago ranking lists by Subejct Area*.          

The numbers of journals per SA vary widely reflecting the differences in sizes of different research disciplines. Random sampling of journals would result in uneven representatation of disciplines biasing the conclusions toward being representative of the largest disciplines, potentially with largest number of relevant awards.    


### Overlap of journals across SCImago Subject Areas 

```{r}
#names(SAdata)
# length(unique(SAdata$Title)) #number of unique journals
# length(unique(SAdata$Title))/length(SAdata$Title) #60% unique

#reduce to top 100 from each SA
SAdata %>% 
  #filter(!is.na(Subject_area)) %>% 
  group_by(Subject_area) %>%
  top_n(100, Title) -> SAdata100

#dim(SAdata100)

#count number of duplicated journal titles across all SA top 100 journal titles:
#sum(duplicated(SAdata100$Title)) #644 duplicated journal Titles
#sum(duplicated(SAdata100$Title))/length(SAdata100$Title) #24% duplicated journal Titles (out of 2700)

#display all duplicate rows in data frame
SAdata100 %>%
  group_by(Title) %>%
  filter(!is.na(Reviewer_name)) %>%
  filter(n()>1) %>%
  ungroup() %>% 
  arrange(Title) #%>% View
```


Across top 100 journals in each SA ranking list there are `r sum(duplicated(SAdata100$Title))` duplicated journal titles (`r round(sum(duplicated(SAdata100$Title))/length(SAdata100$Title)*100, 1)`%). This indicates that one journal can often be classfied into one or more related Subject Areas (e.g. "Trends in Cognitive Sciences" is included bot in Neuroscience and Psychology SA). This overlap implies that the related awards will also often be relevant to more than one SA. Thus, analysing awards    


#### Table S1.    
*Meta-data for the SCImago journal rankings by Subject Areas dataset*.          
```{r}
# making a scrollable table
kable(SAmeta, "html") %>%
  kable_styling("striped", position = "left") %>%
  scroll_box(width = "100%", height = "500px")
```

#### Table S2. 
*Meta-data for the Best Paper awards dataset*.    
```{r}
# making a scrollable table
kable(BPmeta, "html") %>%
  kable_styling("striped", position = "left") %>%
  scroll_box(width = "100%", height = "500px")
```

#### Table S3. 
*Meta-data for the individual winners dataset*.    
```{r}
# making a scrollable table
kable(BPindiv_meta, "html") %>%
  kable_styling("striped", position = "left") %>%
  scroll_box(width = "100%", height = "500px")
```




# Supplementary Results

## Award-level dataset characteristics

**Overall:**
Total number of unique names of awards: `r length(unique(BPdata$Award_name))`.   
Total number of unique names of awards: `r length(unique(BPdata$Scimago_Subject_Area))`.   
Total number of unique names of awarding journals: `r length(unique(BPdata$Awarding_journal))`.   
Total number of unique names of awarding societies: `r length(unique(BPdata$Awarding_society))`.   
Total number of unique names of awarding other bodies: `r length(unique(BPdata$Awarding_other))`.   
Total number of awards without award description: `r table(BPdata$Descr_available, useNA = "always")[2]` (`r round(table(BPdata$Descr_available, useNA = "always")[2] / 223 * 100, 1)`%)

**By awarding or funding body:**
Total number of awards associated with a journal or a few related journals: `r table(BPdata$Awarding_journal != "NA", useNA = "always")[2]` (`r round(table(BPdata$Awarding_journal != "NA", useNA = "always")[2] / 223 * 100, 1)` %)
Total number of awards associated with a learned society: `r table(BPdata$Awarding_society != "NA", useNA = "always")[2]` (`r round(table(BPdata$Awarding_society != "NA", useNA = "always")[2] / 223 * 100, 1)` %)
Total number of awards associated with other organisation (e.g. a publisher, university, charity): `r table(BPdata$Awarding_other != "NA", useNA = "always")[2]` (`r round(table(BPdata$Awarding_other != "NA", useNA = "always")[2] / 223 * 100, 1)` %). Most commonly mentioned other organisations: 
 `r sum(str_count(BPdata$Awarding_other, "Elsevier"))` mention "Elsevier",  `r sum(str_count(BPdata$Awarding_other, "Wiley"))` mention "Wiley").   

**By award starting date**
Award year of the earliest listed winner used as a proxy: `r min(BPdata$Awardee_list_earliest_year, na.rm = TRUE)`.
Number of awards with the earliest listed winner within 2011-2023: `r length(BPdata$Awardee_list_earliest_year[BPdata$Awardee_list_earliest_year > 2010 & !is.na(BPdata$Awardee_list_earliest_year)])` (`r round(length(BPdata$Awardee_list_earliest_year[BPdata$Awardee_list_earliest_year > 2010 & !is.na(BPdata$Awardee_list_earliest_year)]) / 223 * 100, 1)` %).  

**By target career stage:**
Total number of awards for 'any career stage' authors: `r sum(str_count(BPdata$Career_stage, "any career stage"))` (`r round(sum(str_count(BPdata$Career_stage, "any career stage")) / 223 * 100, 1)`%).   
Total number of awards for 'early career' authors: `r sum(str_count(BPdata$Career_stage, "early-career"))` (`r round(sum(str_count(BPdata$Career_stage, "early-career")) / 223 * 100, 1)`%). 
Total number of awards for 'student' authors: `r sum(str_count(BPdata$Career_stage, "student"))` (`r round(sum(str_count(BPdata$Career_stage, "student")) / 223 * 100, 1)`%). 
Total number of awards for 'early career' or 'student' authors: `r sum(str_count(BPdata$Career_stage, "student, early-career"))` (`r round(sum(str_count(BPdata$Career_stage, "student, early-career")) / 223 * 100, 1)`%).  
Total number of awards for 'mid-career'authors: `r sum(str_count(BPdata$Career_stage, "mid-career"))` (`r round(sum(str_count(BPdata$Career_stage, "mid-career")) / 223 * 100, 1)`%).  

**By focus on individuals ("individual award") or whole article ("team award"):**
Total number of awards for individual authors: `r sum(str_count(BPdata$Award_individual, "yes"))` (`r round(sum(str_count(BPdata$Award_individual, "yes")) / 223 * 100, 1)`%).  
Total number of awards for individual authors with any career stage being eligible: `r length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Career_stage == "any career stage"])` (`r round(length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Career_stage == "any career stage"]) / sum(str_count(BPdata$Award_individual, "yes")) * 100, 1)`%).  
Total number of awards for individual authors with inflexible time limits for eligibility:`r length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Flexible_eligibility == "no"])`.  
Total number of awards for individual authors with flexible time limits for eligibility: `r length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Flexible_eligibility == "yes"])`.  

**Summarizing other award characteristics:**
Total number of awards with inclusivity statement: `r sum(str_count(BPdata$Inclusivity_statement, "yes"))` ( `r round(sum(str_count(BPdata$Inclusivity_statement, "yes"))/223 * 100, 1)`%).  
Total number of awards with assessor transparency: `r sum(str_count(BPdata$Assessors_transparency, "yes"))` ( `r round(sum(str_count(BPdata$Assessors_transparency, "yes"))/223 * 100, 1)`%).  
Total number of awards with assessment integrity mentioned: `r sum(str_count(BPdata$Award_integrity_mentioned, "yes"), na.rm = TRUE)` ( `r round(sum(str_count(BPdata$Award_integrity_mentioned, "yes"), na.rm = TRUE)/223 * 100, 1)`%).  
Total number of awards with process transparency: `r sum(str_count(BPdata$Process_transparency, "yes"))` ( `r round(sum(str_count(BPdata$Process_transparency, "yes"))/223 * 100, 1)`%).  
Total number of awards with feedback available: `r sum(str_count(BPdata$Feedback_availability, "yes"))` ( `r round(sum(str_count(BPdata$Feedback_availability, "yes"))/223 * 100, 1)`%).  
Total number of awards with contact details available: `r sum(str_count(BPdata$Award_contact_provided, "yes"))` ( `r round(sum(str_count(BPdata$Award_contact_provided, "yes"))/223 * 100, 1)`%).  
Total number of awards with self-nomination allowed: `r sum(str_count(BPdata$Self_nomination, "yes"))` ( `r round(sum(str_count(BPdata$Self_nomination, "yes"))/223 * 100, 1)`%).
Total number of awards with required nomination letter: `r sum(str_count(BPdata$Letter_required, "yes"))` ( `r round(sum(str_count(BPdata$Letter_required, "yes"))/223 * 100, 1)`%).
Total number of awards with non-vague criteria: `r sum(str_count(BPdata$Criteria_transparency, "yes"))` ( `r round(sum(str_count(BPdata$Criteria_transparency, "yes"))/211 * 100, 1)`%).
Total number of awards with non-vague criteria: `r sum(str_count(BPdata$Award_impact_metrics_mentioned, "yes"))` ( `r round(sum(str_count(BPdata$Award_impact_metrics_mentioned, "yes"))/211 * 100, 1)`%).
Total number of awards with non-vague criteria: `r sum(str_count(BPdata$Award_impact_metrics_only, "yes"))` ( `r round(sum(str_count(BPdata$Award_impact_metrics_only, "yes"))/211 * 100, 1)`%).
Total number of awards which value Open Science: `r sum(str_count(BPdata$Open_science, "yes"))` ( `r round(sum(str_count(BPdata$Open_science, "yes"))/211 * 100, 1)`%).
Total number of awards with cash award: `r sum(str_count(BPdata$Award_cash, "yes"))` ( `r round(sum(str_count(BPdata$Award_cash, "yes"))/223 * 100, 1)`%).

## Award-level dataset characteristics

**Overall:**
Total number of unique names of individual winners records: `r dim(BPindiv)[1]`.   



```{r, eval = FALSE} 
##Check award names - same award could have been extracted in different SA, or different awards have same names 
# table(duplicated(BPdata$Award_name)) #0 duplicated, 223 unique

## Simple counts
# #eligible awards per SA
# count_awards_perSA <- BPdata %>% 
#     count(Scimago_Subject_Area) #%>%
#     #arrange(desc(n)) 
# 
# count_awards <- BPdata %>% 
#  # group_by(Scimago_Subject_Area) %>%
#     count(Descr_available) %>%
#     arrange(desc(n)) #description not available for 12 awards (5%)

# BPdata %>%
#   group_by(Awarding_journal) %>%
#   filter(n() > 1) %>%
#   select(Awarding_journal) %>%
#   filter(!is.na(Awarding_journal)) %>%
#   count() #no journals with more than one award across different

# BPdata %>%
#   group_by(Awarding_society) %>%
#   filter(n() > 1) %>%
#   select(Awarding_society) %>%
#   filter(!is.na(Awarding_society)) %>%
#   count() #some societies with more than one award (max.4)

BPdata %>%
  group_by(Awarding_other) %>%
  filter(n() > 0) %>%
  select(Awarding_other) %>%
  filter(!is.na(Awarding_other)) %>%
  count() #%>% View()#list of other awarding bodies mentioned with counts

# #count number of unique awards per year:
# BPindiv %>% 
#   #filter(!is.na(affiliation_country)) %>% 
#   group_by(award_year) %>% 
#   summarise(count = n_distinct(award_name))  

##How many awards per Scimago_Subject_Area
# table(BPdata$Scimago_Subject_Area) #note many SA with <10 extracted awards - this is because of many journals being shared between SA


table(BPdata$Awarding_journal == "NA") #46 not associated with a journal
table(BPdata$Awarding_society == "NA") #80 not associated with a learned society
table(BPdata$Career_stage, useNA = "always")
table(BPdata$Award_individual, useNA = "always") #62 yes
table(BPdata$Flexible_eligibility, useNA = "always") #only 5 - "yes" 
#View(BPdata[BPdata$Flexible_eligibility == "yes", ]) #see rows with "yes"

#two-way table for the Career_stage and Flexible_eligibility
table(BPdata$Career_stage, BPdata$Flexible_eligibility, useNA = "always") #most "not applicable" is for "any career stage"

#two-way table for the Flexible_eligibility and Award_individual
table(BPdata$Flexible_eligibility, BPdata$Award_individual, useNA = "always") #flexible ones are for ECRs only

#two-way table for the Career_stage and Award_individual
table(BPdata$Career_stage, BPdata$Award_individual, useNA = "always") #individual are mostly for ECRs
#BPdata$Award_name[BPdata$Career_stage == "unclear"]
#BPdata$Award_name[BPdata$Career_stage == "early-career" & BPdata$Award_individual == "no"]
#BPdata$Award_name[BPdata$Career_stage == "early-career" & BPdata$Award_individual == "no"]
#length(BPdata$Award_name[BPdata$Career_stage == "any career stage" & BPdata$Award_individual == "no"]) #151

#three-way table
table(BPdata$Career_stage, BPdata$Flexible_eligibility, BPdata$Award_individual) #most "not applicable" is for "any career stage"

#length(BPdata$Award_name[BPdata$Career_stage == "any career stage" & BPdata$Award_individual == "no"]) #151
length(BPdata$Award_name[BPdata$Award_individual == "no" & BPdata$Career_stage == "any career stage" & BPdata$Flexible_eligibility == "not applicable"]) #146 not applicable flexibility
length(BPdata$Award_name[BPdata$Award_individual == "no" & BPdata$Career_stage == "any career stage" & BPdata$Flexible_eligibility == "not available"]) #5 with no description
length(BPdata$Award_name[BPdata$Award_individual == "no" & BPdata$Career_stage == "any career stage" & BPdata$Flexible_eligibility == "yes"]) #0 with flexibility

length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Career_stage == "any career stage"]) #29 not limited to specific career stage
length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Flexible_eligibility == "not applicable"]) #39 not applicable flexibility
length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Flexible_eligibility == "not available"]) #2 with no description
length(BPdata$Award_name[BPdata$Award_individual == "yes" & BPdata$Flexible_eligibility == "yes"]) #5 with flexibility


table(BPdata$Inclusivity_statement, useNA = "always") #only 2 "yes"
BPdata$Award_name[BPdata$Inclusivity_statement == "yes"] #see rows with "yes"

table(BPdata$Assessors_transparency, useNA = "always") #115 "yes"
#View(BPdata[BPdata$Assessors_transparency == "yes", ]) #see rows with "yes"
names(BPdata)
# sum(str_count(tolower(BPdata$Assessor_phrasing), "editor"), na.rm = TRUE) #163 - counting all mentions
# sum(str_detect(BPdata$Assessor_phrasing, "editor"), na.rm = TRUE) #37 - counting once per award

table(BPdata$Process_transparency, useNA = "always") #only 1 "yes"
#BPdata$Award_name[BPdata$Process_transparency == "yes"] #see award name with "yes"

table(BPdata$Self_nomination, useNA = "always") #28 yes
#View(BPdata[BPdata$Self_nomination == "yes", ]) #see rows with "yes"

table(BPdata$Letter_required, useNA = "always") #38 yes
#View(BPdata[BPdata$Letter_required == "yes", ]) #see rows with "yes"

table(BPdata$Letter_required, BPdata$Self_nomination, useNA = "always") #two-way table
dim(BPdata[BPdata$Letter_required == "yes" & BPdata$Self_nomination == "yes", ])[1] #mentioning letter and self-nomination 
dim(BPdata[BPdata$Letter_required == "no" & BPdata$Self_nomination == "no", ])[1] #not mentioning letter and self-nomination 

table(BPdata$Feedback_availability, useNA = "always") #0 "yes"

table(BPdata$Award_contact_provided, useNA = "always") #38 "yes"

table(BPdata$Criteria_transparency, useNA = "always") #40 yes
#View(BPdata[BPdata$Criteria_transparency == "yes", ]) #see rows with "yes"

table(BPdata$Award_impact_metrics_mentioned, useNA = "always") #21 "yes"

table(BPdata$Award_impact_metrics_only, useNA = "always") #8 "yes"

table(BPdata$Open_science, useNA = "always") #1 "yes"
View(BPdata[BPdata$Open_science == "yes", ]) #see rows with "yes": Social Sciences: Review Of Research Award  by American Educational Research Association. Two journals are considered: Review of Educational Research. Review of Research in Education

table(BPdata$Awardee_list_most_recent_year, useNA = "always") #a few <2020 and 6 NA
#View(BPdata[is.na(BPdata$Awardee_list_most_recent_year), ]) #see rows with NA

table(BPdata$Awardee_list_earliest_year, useNA = "always") #some very old, 19 NA
#View(BPdata[is.na(BPdata$Awardee_list_earliest_year), ]) #see rows with NA
#hist(BPdata$Awardee_list_earliest_year)
length(BPdata$Awardee_list_earliest_year[BPdata$Awardee_list_earliest_year > 2010 & !is.na(BPdata$Awardee_list_earliest_year)] ) #107 from 2011-2023
```


## Figure 1

A. Screening effort - count numbers of journals screened to get 10 shortlisted awards 
```{r}
#load journal screening summary dataset:
BPscreening <- read_csv(here("data","BP_awards_lists_SHAREDCOPY - scimagojr_2021_SA.csv")) #load award screening summary data TODO
BPscreening <- BPscreening[!is.na(BPscreening$Subject_Area), ] #remove 2 extra rows without Subject_Area
count_awards_perSA <- BPdata %>% count(Scimago_Subject_Area) #count included awards per SA
BPscreening$N_included <- count_awards_perSA$n #add included award counts per SA
BPscreening$N_excluded <- BPscreening$N_records_screened - BPscreening$N_included 
BPscreening$Subject_Area <- as.factor(BPscreening$Subject_Area) #convert to factor

## reshape into long dataframe format:
BPscreening %>% select(Subject_Area, N_included, N_excluded) %>% gather(key = status, count, N_included:N_excluded) -> BPscreening_long

#reorder status levels and edit labels:
BPscreening_long <- BPscreening_long %>% 
  mutate(status = factor(status, levels = rev(c("N_excluded", "N_included"))))

BPscreening_long$status <- as.character(BPscreening_long$status)  #convert to character
BPscreening_long$status[BPscreening_long$count <= 5] <- "N_included_low" #use to mark SA with 5 or less awards included    

  
figure1A <- BPscreening_long %>%
    mutate(status = recode(status, 'N_excluded' = 'not found', 'N_included_low' = 'found and included (<=5)', 'N_included' = 'found and included (>5 awards)')) %>%
    ggplot(aes(x = reorder(Subject_Area, desc(Subject_Area)), y = count, fill = status)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,25,50,75,100)) +
    theme_bw() + 
    scale_fill_manual(values = c("#CDC8B1", "#8B8878", "#EEE8CD")) +
    labs(x = "Scimago Subject Area", y = "Count of screened Scimago journals", fill = "Award: ") + 
    theme(legend.position = "top", legend.justification=c(0, 1), axis.title.x = element_text(size = 10)) +
    geom_hline(yintercept = 10, linetype = "dotted", color = "red", size = 0.6) + 
    scale_x_discrete(position = "top")

```


B. Include awards with and without award description

```{r}
figure1B <- BPdata %>%
    count(Scimago_Subject_Area, Descr_available) %>%
    arrange(desc(n)) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Descr_available)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_bw() + 
    scale_fill_manual(values = c("#669933", "gray80")) +
    labs(x = "", y = "Count of included awards", fill = "Award description:") + 
    scale_x_discrete(labels = NULL) + labs(x = "")  + #used to remove vertical labels, also breaks = NULL
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

## Award descriptions

Word counts per award description:

```{r}
#add new variable with counts of words in the award description:
BPdata$Award_description_wordcount <- str_count(BPdata$Award_description, "\\w+")
#hist(str_count(BPdata$Award_description, "\\w+"), breaks = 20)

BPdata[is.na(BPdata$Scimago_Subject_Area), ] #no NA, but no description was coded as NA, so if 1 then change to 0 (no description)
BPdata$Award_description_wordcount[BPdata$Award_description_wordcount < 2] <- 0 #if 1 then change to 0 (no description)

#dim(BPdata[BPdata$Award_description_wordcount < 100, ])[1] #90 descriptions have less than 100 words! (includes 12 with no description)
#dim(BPdata[BPdata$Descr_available == "available" & BPdata$Award_description_wordcount < 150, ])[1] #120 descriptions have less than 200 words! (excludes 12 with no description), so 120/211 (75%)

# BPdata[BPdata$Award_description_wordcount > 250, c("Scimago_Subject_Area", "Award_name", "Award_description")] #18 awards (9%)
# BPdata[BPdata$Award_description_wordcount > 400, c("Scimago_Subject_Area", "Award_name", "Award_description")] #5 awards (2%)
# BPdata[BPdata$Award_description_wordcount > 500, c("Scimago_Subject_Area", "Award_name", "Award_description")] #2 awards (1%)
```

Median length of award description: `r median(BPdata$Award_description_wordcount[BPdata$Descr_available == "available"], na.rm = TRUE) `.   
Plot of award description lengths - overall:

```{r}
figure1C <- BPdata %>% 
  filter(!is.na(Award_description_wordcount)) %>%
  ggplot(aes(x = Award_description_wordcount)) + 
  geom_histogram(binwidth = 20, fill = "grey60") +
  theme_bw() + 
  labs(x = "Number of words in award description", y = "Award count") + 
  scale_x_continuous(breaks = c(seq(0, 1000, by = 100))) +
  theme(legend.position = "none", axis.title.x = element_text(size = 10))
```

Plot of award description lengths - by Subject Area

```{r}
BPdata %>% 
  filter(!is.na(Award_description_wordcount)) %>%
  ggplot(aes(x = Award_description_wordcount)) + 
  geom_histogram(binwidth = 20, fill = "grey60") +
  theme_bw() + 
  labs(x = "Number of words in award description", y = "Award count") + 
  scale_x_continuous(breaks = c(seq(0, 1000, by = 100))) +
  theme(legend.position = "none", axis.title.x = element_text(size = 10)) + 
  facet_wrap(~Scimago_Subject_Area, ncol = 3)
```

How old are the awards?
NOTE: Using the year of oldest listed past winner as a proxy.  

Overall:
```{r}
#table(!is.na(BPdata$Awardee_list_earliest_year)) # values available

#plot overall - beeswarm
figure1D <- BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>%
  ggplot(aes(y = Awardee_list_earliest_year, x = Row_excluded)) + 
  geom_beeswarm(color = "#000000", alpha = 0.2, cex = 3.3) +
  coord_flip() +
  theme_bw() + 
  labs(y = "Past winners earliest year", x = "") + 
  scale_x_discrete(labels = NULL) + labs(x = "")  + #used to remove vertical labels, also breaks = NULL
  scale_y_continuous(breaks = c(seq(1900, 2030, by = 10))) +
  theme(legend.position = "none", axis.title.x = element_text(size = 10)) +
  annotate("rect", ymin = 2001, ymax = 2022, xmin = -1.5, xmax = 1.5, alpha = .1,fill = "#008B00")
```

Plot by Subject Area: 

```{r}
#plat by SA - beeswarm
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>%
  ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = Awardee_list_earliest_year)) + 
  geom_beeswarm(color = "#000000", alpha = 0.1) +
  coord_flip() +
  theme_bw() + 
  labs(y = "Past winners earliest year", x = "Scimago Subject Area") + 
  scale_y_continuous(breaks = c(seq(1900, 2030, by = 10))) +
  theme(legend.position = "none", axis.title.x = element_text(size = 10))
```


Combine 4 panels and save:  
```{r}
#assemble the panels using patchwork package
figure1 <- (figure1A + figure1B) / figure1C / figure1D + 
  plot_layout(widths = c(1, 1), heights = c(3, 1, 1)) +
  plot_annotation(tag_levels = "A")

#ggsave(plot = figure1, here("plots", "Fig1ABCD_screening_descriptions_v0.png"), width = 18, height = 18, units = "cm", dpi = "retina", scale = 1.2)
#ggsave(plot = figure1, here("plots", "Fig1ABCD_screening_descriptions_v0.pdf"), width = 18, height = 18, units = "cm", scale = 1.2)
```


## Figure 2

Figure 2A - Awarding bodies

```{r}
# table(BPdata$Awarding_journal == "NA")
# table(BPdata$Awarding_society == "NA")
# table(BPdata$Awarding_other == "NA")

#create new variable with simple categorisation of awarding body type mentioned:
BPdata2 <- BPdata %>%
   mutate(
     Awarded_by = case_when(Awarding_journal != "NA" & Awarding_society == "NA" & Awarding_other == "NA" ~ "journal", 
     Awarding_journal == "NA" & BPdata$Awarding_society != "NA" & BPdata$Awarding_other == "NA" ~ "society", 
     Awarding_journal == "NA" & BPdata$Awarding_society == "NA" & BPdata$Awarding_other != "NA" ~ "other", 
     Awarding_journal != "NA" & BPdata$Awarding_society != "NA" & BPdata$Awarding_other == "NA" ~ "journal&society",
     Awarding_journal != "NA" & BPdata$Awarding_society != "NA" & BPdata$Awarding_other != "NA" ~ "journal&society&other", 
     Awarding_journal != "NA" & BPdata$Awarding_society == "NA" & BPdata$Awarding_other != "NA" ~ "journal&other", 
     Awarding_journal == "NA" & BPdata$Awarding_society != "NA" & BPdata$Awarding_other != "NA" ~ "society&other", 
     TRUE ~ "none")
   )

#table(BPdata$Awarded_by)

#create new variable for awards with description or without
BPdata2 %>%  
  select(Award_name, Awarding_journal, Awarding_society, Awarding_other) %>% 
  mutate(
    across(c(Awarding_journal, Awarding_society, Awarding_other), ~ if_else(. == "NA", FALSE, TRUE))
  ) -> BPdata2

#make upset plot using library(ggupset)
figure2A <- BPdata2 %>% 
  column_to_rownames(var = "Award_name") %>% 
  as_tibble(rownames = "Award_name") %>%
  gather(Body, Award, -Award_name) %>% 
  filter(Award) %>%
  select(-Award) %>%
  mutate(Body = recode(Body, 'Awarding_journal' = 'journal', 'Awarding_society' = 'society', 'Awarding_other' = 'other')) %>%
  group_by(Award_name) %>%
  summarize(Awarding_bodies = list(Body)) %>%
  ggplot(aes(x = Awarding_bodies)) +
    geom_bar(fill = "#a70042", width = 0.8) +
    scale_x_upset(order_by = c("freq")) +
    theme_combmatrix(combmatrix.panel.striped_background = FALSE,
                    combmatrix.panel.point.color.fill = "#a70042",
                    combmatrix.panel.line.color = "#a70042",
                    plot.title = element_text(family = "sans", size = 20, face = "plain", color = "black"),
                    axis.title.x = element_text(family="sans", size = 14, color = "black", face="plain"), 
                    axis.title.y = element_text(family="sans", size = 14, color = "black", face = "plain", vjust = -2),
                    ) +
    labs(title = "A", x = "Awarding bodies combination", y = "Award count")
```


Figure 2B - target awardee career stages

```{r}
#table(BPdata$Career_stage) #mai options: student, early-career, mid-career, any career stage, unclear

#create new variable with separate career stage values as a list
BPdata2 %>%  
  mutate(
    Career_stage_list = str_split(BPdata$Career_stage, pattern = ", ")
  ) -> BPdata2

#BPdata$Career_stage_list <- str_split(BPdata$Career_stage, pattern = ", ") #sam as above but modifies original data frame

#make upset plot using library(ggupset)
figure2B <- BPdata2 %>% 
  ggplot(aes(x = Career_stage_list)) +
    geom_bar(fill = "#8B6969",width = 0.8) +
    scale_x_upset(order_by = c("freq")) +
    theme_combmatrix(combmatrix.panel.striped_background = FALSE,
                    combmatrix.panel.point.color.fill = "#8B6969",
                    combmatrix.panel.line.color = "#8B6969",
                    plot.title = element_text(family = "sans", size = 20, face = "plain", color = "black"),
                    axis.title.x = element_text(family="sans", size = 14, color = "black", face="plain"), 
                    axis.title.y = element_text(family="sans", size = 14, color = "black", face = "plain", vjust = -2),
                    ) + 
    labs(title = "B", x = "Target career stages combination", y = "")
```

Combine 2 panels and save

```{r}
#assemble the panels using patchwork package
figure2 <- figure2A / figure2B + 
  plot_layout(ncol = 2, nrow = 1, widths = c(1, 1)) #+  plot_annotation(tag_levels = "A") #does not work with this lot type

#ggsave(plot = figure2, here("plots", "Fig2AB_award_descriptions_v0.png"), width = 18, height = 8, units = "cm", bg = "white", dpi = "retina", scale = 1.6)
#ggsave(plot = figure2, here("plots", "Fig2AB_award_descriptions_v0.pdf"), width = 18, height = 8, units = "cm", scale = 1.6)
```


## Figure 3

```{r}
#BPdata %>%
#    count(Open_science) %>%
#    ggplot(aes(x = Open_science, y = n, fill = Open_science)) + 
#    geom_col(width = 0.7) +
#    geom_text(position = position_stack(vjust = 0.5), aes(label = n)) + 
#    theme_classic() + 
#    coord_flip() +
#    labs(x = "Open Science valued", y = "Article count", fill = "Open_science") + 
#    theme(legend.position = "none", axis.title.x = element_text(size = 10))
```

Figure 3A - Summary plots of key award characteristics

```{r}
BPdata %>% select(Award_individual, Flexible_eligibility, Inclusivity_statement, Assessors_transparency, Award_integrity_mentioned, Process_transparency, Self_nomination, Letter_required, Feedback_availability, Award_contact_provided) -> BPdata3

## reshape into long dataframe format:
BPdata3 %>% gather(key = var_name, value = value, 1:ncol(BPdata3)) -> BPdata3long
#str(BPdata3long)

#reorder var_name levels
BPdata3long <- BPdata3long %>% mutate(var_name = factor(var_name, levels = rev(c("Award_individual",
                                                                            "Flexible_eligibility", 
                                                                            "Inclusivity_statement", 
                                                                            "Assessors_transparency", 
                                                                            "Award_integrity_mentioned", 
                                                                            "Process_transparency",
                                                                            "Self_nomination", 
                                                                            "Letter_required", 
                                                                            "Feedback_availability", 
                                                                            "Award_contact_provided" 
                                                                            ))))


#reorder value levels:
BPdata3long <- BPdata3long %>% mutate(value = factor(value, levels = rev(c("no",
                                                                            "yes", 
                                                                            "not applicable", 
                                                                            "not available"))))
figure3A <- BPdata3long %>% 
  group_by(var_name) %>% 
  count(var_name, value) %>% 
  ggplot(aes(x = var_name, y = n, fill = value)) +
  #geom_bar(aes(fill = value), stat = "identity", position = position_dodge(0.9)) +
  geom_bar(aes(fill = value), stat = "identity") +
  coord_flip() +
  scale_fill_manual(values = c("#E5E5E5", "#CCCCCC", "#C1FFC1",  "#FA8072")) +
  labs(x = "Award characteristics", y = "Award count", fill = "Award scores") + 
  scale_x_discrete(labels = rev(c("Award is focused on individual authors",
                            "Eligibility career timeline is flexible", 
                            "Inclusivity statement or encouragement is provided",
                            "Assessors are revealed",
                            "Award integrity mentioned", 
                            "Process is transparent",
                            "Self-nomination is allowed",
                            "Nomination letter is required",
                            "Feedback is availabile", 
                            "Award contact point is provided"
                            ))) +
  theme_classic()
```


Figure 3B - Summary plots of key award characteristics

```{r}
BPdata %>% select(Criteria_transparency, Award_impact_metrics_mentioned, Award_impact_metrics_only, Open_science) -> BPdata3

## reshape into long dataframe format:
BPdata3 %>% gather(key = var_name, value = value, 1:ncol(BPdata3)) -> BPdata3long
#str(BPdata3long)

#reorder var_name levels
BPdata3long <- BPdata3long %>% mutate(var_name = factor(var_name, levels = rev(c( "Criteria_transparency", 
                                                                            "Award_impact_metrics_mentioned", 
                                                                            "Award_impact_metrics_only", 
                                                                            "Open_science"))))

#reorder value levels:
BPdata3long <- BPdata3long %>% mutate(value = factor(value, levels = rev(c("no",
                                                                            "yes", 
                                                                            "not available"))))
figure3B <- BPdata3long %>% 
  group_by(var_name) %>% 
  count(var_name, value) %>% 
  ggplot(aes(x = var_name, y = n, fill = value)) +
  #geom_bar(aes(fill = value), stat = "identity", position = position_dodge(0.9)) +
  geom_bar(aes(fill = value), stat = "identity") +
  coord_flip() +
  scale_fill_manual(values = c("#E5E5E5", "#C1FFC1",  "#FA8072")) +
  labs(x = "Award criteria", y = "Award count", fill = "Award scores") + 
  scale_x_discrete(labels = rev(c("Assessment criteria are detailed out",
                            "Impact metrics are mentioned in criteria",
                            "Impact metrics are only criteria", 
                            "Open Science practices are valued"))) +
  theme_classic()

```

Combine 2 panels and save

```{r}
#assemble the panels using patchwork package
figure3 <- figure3A / figure3B + 
  plot_layout(ncol = 1, nrow = 2, heights = c(2, 1)) + 
  plot_annotation(tag_levels = "A") 

#ggsave(plot = figure3, here("plots", "Fig3AB_award_descriptions_v0.png"), width = 18, height = 10, units = "cm", bg = "white", dpi = "retina", scale = 1.2)
#ggsave(plot = figure2, here("plots", "Fig3AB_award_descriptions_v0.pdf"), width = 18, height = 10, units = "cm", scale = 1.2)
```

## Award characteristics by SA

Figure SX - Award_individual by SA

```{r}
#table(BPdata$Award_individual) #as a table - 62 are individual(28%)
#table(BPdata$Scimago_Subject_Area, BPdata$Award_individual) #as a table - 9 disciplines have 0!

BPdata %>% 
    mutate(Award_individual = factor(Award_individual, levels = (c("no", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Award_individual) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Award_individual)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Award is focused on individual authors:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Figure SX - Flexible_eligibility by SA

```{r}
#table(BPdata$Flexible_eligibility, useNA = "always") #as a table
#table(BPdata$Scimago_Subject_Area, BPdata$Flexible_eligibility, useNA = "always") #as a table

BPdata %>% 
    mutate(Flexible_eligibility = factor(Flexible_eligibility, levels = c("no", "yes", "not applicable", "not available"))) %>%
    count(Scimago_Subject_Area, Flexible_eligibility) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Flexible_eligibility)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#C1FFC1", "#CCCCCC", "#E5E5E5")) +
    #scale_fill_manual(values = c("#FA8072", "#FA807210", "#F1FFC1", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Eligibility career timeline is flexible:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Figure SX - Inclusivity_statement by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Inclusivity_statement) #as a table

BPdata %>% 
    mutate(Inclusivity_statement = factor(Inclusivity_statement, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Inclusivity_statement) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Inclusivity_statement)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Inclusivity statement or encouragement is provided:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Figure SX - Inclusivity_statement by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Assessors_transparency) #as a table

BPdata %>% 
    mutate(Assessors_transparency = factor(Assessors_transparency, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Assessors_transparency) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Assessors_transparency)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Assessors are revealed (names or as journal editors):") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Figure SX - Inclusivity_statement by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Process_transparency) #as a table

BPdata %>% 
    mutate(Process_transparency = factor(Process_transparency, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Process_transparency) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Process_transparency)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Process is transparent:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Figure SX - Self_nomination by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Self_nomination) #as a table

BPdata %>% 
    mutate(Self_nomination = factor(Self_nomination, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Self_nomination) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Self_nomination)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Self-nomination is allowed:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Figure SX - Letter_required by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Letter_required) #as a table

BPdata %>% 
    mutate(Letter_required = factor(Letter_required, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Letter_required) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Letter_required)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Nomination letter is required:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```
                                    
Figure SX - Feedback_availability by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Feedback_availability) #as a table

BPdata %>% 
    mutate(Feedback_availability = factor(Feedback_availability, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Feedback_availability) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Feedback_availability)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Feedback is availabile:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```
                                  
Figure SX - Award_contact_provided by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Award_contact_provided) #as a table

BPdata %>% 
    mutate(Award_contact_provided = factor(Award_contact_provided, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Award_contact_provided) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Award_contact_provided)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Award contact point is provided:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```
                                                                             
Figure SX - Criteria_transparency by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Criteria_transparency) #as a table

BPdata %>% 
    mutate(Criteria_transparency = factor(Criteria_transparency, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Criteria_transparency) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Criteria_transparency)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Assessment criteria are detailed out:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```
                                                                            
Figure SX - Award_impact_metrics_mentioned by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Award_impact_metrics_mentioned) #as a table

BPdata %>% 
    mutate(Award_impact_metrics_mentioned = factor(Award_impact_metrics_mentioned, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Award_impact_metrics_mentioned) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Award_impact_metrics_mentioned)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Impact metrics are mentioned in criteria:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```
                                                                     
Figure SX - Award_impact_metrics_only by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Award_impact_metrics_only) #as a table

BPdata %>% 
    mutate(Award_impact_metrics_only = factor(Award_impact_metrics_only, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Award_impact_metrics_only) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Award_impact_metrics_only)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Impact metrics are only criteria:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```
                                                                          
Figure SX - Open_science by SA

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Open_science) #as a table

BPdata %>% 
    mutate(Open_science = factor(Open_science, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    count(Scimago_Subject_Area, Open_science) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Open_science)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Open Science practices are valued:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```



## Text mining of award descriptions

Award descriptions - wordcloud of frequencies all words.   

```{r}
#Using packages tidytext and stopwords
Award_description_txt <- tibble(txt = tolower(BPdata$Award_description))
Award_description_txt <- Award_description_txt %>% unnest_tokens(output = word, input = txt, token = "words", to_lower = TRUE) #restructure all descriptions as one-token-per-row format
Award_description_txt <- Award_description_txt %>% anti_join(get_stopwords()) #remove stop words from library(stopwords) 
Award_description_txt <- Award_description_txt %>% anti_join(get_stopwords()) #remove stop words from library(stopwords) 
Award_description_txt$word <- tokenize_word_stems(Award_description_txt$word) #make all word stems lowercase
word.freq <- Award_description_txt %>% count(word, sort = TRUE) #count words

## plot wordcloud using library(wordcloud) for top 100 words
#word.freq %>% with(wordcloud(word, n, max.words = 100, random.order = FALSE, rot.per = 0.35, colors = brewer.pal(12, "Paired")))
```

Award descriptions - count mentions of specific words (stemmed):

```{r}
#create list of specific words (stemmed) to count within strings
specific.words <- c("best", "outstand", "impact", "original", "significant", "merit", "excell", "innovat", "novel", "creativ", "transparen", "reliab", "robust", "reproduc", "replica", "rigor", "rigour", "trust")

#prepare award descriptions as a single lowercase string
descriptions <- BPdata %>% 
  filter(!is.na(Award_description)) %>% 
  select(Award_description) %>% 
  tolower() #single lowercase string

#sum of all mentions for each word
specific.words.mentions <- specific.words %>%
  map_int(~ str_count(tolower(descriptions), .x))

#prepare award descriptions while keeping them separate for each award
descriptions2 <- tolower(BPdata$Award_description) #vector of lowercase strings

#sum of mentions per award for each word (counts only one mention per award)
specific.words.mentions2 <- specific.words %>%
  map_int(~ sum(str_detect(descriptions2, .x), na.rm = TRUE))

# ## doing the same as above, but manually:
# #count all mentions of words(parts) individually, e.g.:
# sum(str_count(tolower(BPdata$Award_description), "best"), na.rm = TRUE) #169
# #counting once per award, e.g. 
# sum(str_detect(BPdata$Award_description, "best"), na.rm = TRUE) #82
```

## Figure 4

Plot frequencies of specific words - all mentions in award descriptions.  
```{r}
words.df <- tibble(Words = specific.words, 
                            Count_all = specific.words.mentions,
                            Count_once = specific.words.mentions2)

figure4A <- words.df %>%
    ggplot(aes(x = reorder(Words, Count_all), y = Count_all)) + 
    geom_col(width = 0.8, fill = "#838B83") +
    coord_flip() +
    scale_y_continuous(breaks = c(0, 50, 100, 150), limits = c(0, 200)) +
    theme_bw() + 
    labs(x = "Word stem", y = "Count of all mentions") + 
    annotate(geom = "rect",xmin = 8.5, xmax = Inf, ymin = -Inf, ymax = Inf, fill = "#A52A2A", alpha = 0.1) +
    annotate(geom = "rect",xmin = -Inf, xmax = 8.5, ymin = -Inf, ymax = Inf, fill = "#00FF00", alpha = 0.1) +
    theme(legend.position = "none", axis.title.x = element_text(size = 10))
```

Plot frequencies of specific words - first mentions in award descriptions.  
```{r}
figure4B <- words.df %>%
    ggplot(aes(x = reorder(Words, Count_all), y = Count_once)) + 
    geom_col(width = 0.8, fill = "#C1CDC1") +
    coord_flip() +
    scale_y_continuous(breaks = c(0, 50, 100, 150), limits = c(0, 200)) +
    theme_bw() + 
    labs(x = "Word stem", y = "Count of first mention per award") + 
    scale_x_discrete(labels = NULL) + labs(x = "")  + #used to remove vertical labels, also breaks = NULL
    annotate(geom = "rect",xmin = 8.5, xmax = Inf, ymin = -Inf, ymax = Inf, fill = "#A52A2A", alpha = 0.1) +
    annotate(geom = "rect",xmin = -Inf, xmax = 8.5, ymin = -Inf, ymax = Inf, fill = "#00FF00", alpha = 0.1) +
    theme(legend.position = "none", axis.title.x = element_text(size = 10))
```

Combine 2 panels and save:
```{r}
#assemble the panels using patchwork package
figure4 <- figure4A / figure4B + 
  plot_layout(ncol = 2, nrow = 1) +
  plot_annotation(tag_levels = "A")
#ggsave(plot = figure4, here("plots", "Fig4AB_words_counts_v0.png"), width = 18, height = 8, units = "cm", dpi = "retina", scale = 1.2)
#ggsave(plot = figure4, here("plots", "Fig4AB_words_counts_v0.pdf"), width = 18, height = 8, units = "cm", scale = 1.2)
```



## Characteristics of the past winners

How many awards extracted overall?
```{r}
length(unique(BPdata$Award_name[BPdata$N_winners_extracted != 0])) #62 - number from the records in the award-level data set
length(unique(BPindiv$award_name)) #62 - number from records in past winner's data
```

How many awards extracted per SA?
```{r}
#from BPdata:
BPdata %>% 
  group_by(Scimago_Subject_Area) %>% 
  filter(N_winners_extracted != 0) %>% 
  count(Scimago_Subject_Area) -> awards_perSA

# #from BPindiv:
# BPindiv %>%  
#   group_by(award_SA) %>%
#   summarise(count = n_distinct(award_name))

#plot counts where >0 awards per SA
p_count.awards.SA <- BPindiv %>% 
  group_by(award_SA) %>%
  summarise(count = n_distinct(award_name)) %>% 
  ggplot(aes(x = reorder(award_SA, desc(award_SA)), y = count)) +
  geom_bar(stat = "identity", position = position_dodge(0.9)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Scimago Subject Area", y = "Award count")  
```

How many records (names) extracted overall?
```{r}
#sum(BPdata$N_winners_extracted, na.rm = TRUE) #number from the records in the award-level data set
#dim(BPindiv)[1] #number of records in past winner's data
```

How many records (names) extracted per SA?
```{r}
#from BPdata:
BPdata %>% 
  group_by(Scimago_Subject_Area) %>% 
  select(N_winners_extracted) %>% 
  filter(!is.na(N_winners_extracted)) %>% 
  summarise(sum_winners = sum(N_winners_extracted), .groups = 'drop') -> winners_perSA1
winners_perSA1[winners_perSA1$sum_winners == 0, ] #8 SA without any extracted names
dim(winners_perSA1[winners_perSA1$sum_winners != 0, ])[1] #number of SA with any extracted names
winners_perSA1[winners_perSA1$sum_winners != 0, ] #table of SA with any extracted names

#from BPindiv:
#table(BPindiv$award_SA)
dim(table(BPindiv$award_SA, useNA = "always")) #19 SA with any extracted names
BPindiv %>%
  group_by(award_SA) %>% count() -> winners_perSA1_extracted #does not show SA with 0 extracted

#plot counts where >0 winners per SA
p_count.awardees.SA <- BPindiv %>% 
  group_by(award_SA) %>% count() %>%
  ggplot(aes(x = reorder(award_SA, desc(award_SA)), y = n)) +
  geom_bar(stat = "identity", position = position_dodge(0.9)) +
  coord_flip() +
  theme_bw() +
  #scale_x_discrete(labels = NULL) + labs(x = "")  + #used to remove vertical labels, also breaks = NULL
  labs(x = "Scimago Subject Area", y = "Awardee count")  

# View(left_join(x = winners_perSA1, y = winners_perSA1_extracted, by = c("Scimago_Subject_Area" = "award_SA"))) #check if matching numbers
```

Combine plots of total counts of awards and winners per SA  
```{r}
#assemble the panels using patchwork package
count.awards.awardees_SA <- p_count.awards.SA / p_count.awardees.SA + 
  plot_layout(ncol = 2, nrow = 1) +
  plot_annotation(tag_levels = "A")

#ggsave(here("plots", "count.awards.awardees_SA_v1.png"), width = 18, height = 8, units = "cm", dpi = "retina")
#ggsave(here("plots", "count.awards.awardees_SA_v1.pdf"), width = 18, height = 8, units = "cm")
```

How many records per decade?
```{r}
table(BPindiv$award_year, useNA = "always")

#create decade variable 2001-2010, 2011-2020, 2021-2022
BPindiv %>%  mutate(Decade = case_when(
    award_year >= 2001 & award_year <= 2010 ~ "2001-2010",
    award_year >= 2011 & award_year <= 2020 ~ "2011-2020",
    award_year >= 2021 & award_year <= 2022 ~ "2021-2022",
    award_year == "Veterinary" ~ "Biology",
    TRUE ~ NA)
    ) -> BPindiv

table(BPindiv$Decade, useNA = "always")
```

How many records per decade and SA?
```{r}
table(BPindiv$award_SA, BPindiv$Decade)
```

How many individuals shared awards?
```{r}
table(BPindiv$shared, useNA = "always") #157 shared (14% of names), usually shared by 2 authors)
table(BPindiv$Decade, BPindiv$shared) #more common recently?
table(BPindiv$award_SA, BPindiv$shared) # sharing most frequent in Computer Science
```

How many awards had article information?

NOTE: during first round of data extraction, we located around 3/4 of winning articles - these were articles where title or DOI was available on award page or announcement. However, article information was sometimes only publicly listed for recently awarded articles.  Additional Internet searches increased the number of identified articles to `r length(unique(BPindiv$awarded_paper_ref))`.  

```{r}
table(is.na(BPindiv$awarded_paper_ref)) #200 missing (out of 1083 = 18%)
table(is.na(BPindiv$awarded_paper_doi)) #201 missing (out of 108s = 18%)
```

How many have gender assigned and how?
```{r}
table(BPindiv$awardee_gender, useNA = "always") #0 missing or unclear
round(table(BPindiv$awardee_gender, useNA = "always")/length(BPindiv$awardee_gender) * 100, 1) #as percentages

table(BPindiv$gender_source, useNA = "always") #0 missing - change to "not found"
round(table(BPindiv$gender_source, useNA = "always")/length(BPindiv$awardee_gender) * 100, 1) #as percentages
```


### Awardee gender

Gender counts overall
```{r}
BPindiv %>%  
   group_by(award_SA) %>%
   count(awardee_gender)

BPindiv %>% 
  group_by(Decade) %>%
  count(awardee_gender)
```

Gender plot overall
```{r}

## set the levels in order we want:
BPindiv$Gender <- factor(BPindiv$awardee_gender)
levels(BPindiv$Gender) <- c("female", "male")

## plot for a all SA and years - not stacked, with count values:
BPindiv %>%  
#  group_by(award_SA) %>%
  count(Gender) %>%
  ggplot(aes(x = Gender, y = n)) +
  geom_bar(aes(fill = Gender), stat = "identity", position = position_dodge(0.9)) +
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) +
  theme_bw() +
  theme(legend.position = "none", legend.box = "horizontal", axis.text = element_text(size = 10)) +
  labs(fill = "Awardee gender:") +
  labs(x = "Awardees", y = "Awardee count")  
```

Gender plots by Decade 
```{r}
## plot for a all awards by Decade - not stacked, with count values (40-41% in each decade):
BPindiv %>% 
  group_by(Decade) %>%
  count(Gender) %>%
  ggplot(aes(x = Decade, y = n, fill = Gender)) +
  geom_bar(aes(fill = Gender), stat = "identity", position = position_dodge(0.8), width = 0.8, col = "white") + # use , position = "fill" for proportion plot
#  coord_flip() + 
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) +
  theme_bw() +
  theme(legend.position="top", legend.box = "horizontal", axis.text = element_text(size = 10)) +
  labs(fill = "Awardee gender:") +
  labs(x = "Decade", y = "Awardee count")  


## plot for a all awards by Decade - horizontal, not stacked, with count values:
figure5A <- BPindiv %>% 
  group_by(Decade) %>%
  count(Gender) %>%
  ggplot(aes(y = Decade, x = n, fill = Gender)) +
  geom_bar(aes(fill = Gender), stat = "identity") + 
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) +
  theme_bw() +
  theme(legend.position="top", legend.text = element_text(size = 8), legend.title = element_text(size = 8),
        axis.text = element_text(size = 10), legend.box = "horizontal", legend.margin = margin()) +
  guides(fill = guide_legend(nrow = 1, byrow = TRUE, reverse = TRUE)) + 
  labs(fill = "Awardee gender:") +
  labs(y = "Decade", x = "Awardee counts")  

## plot for a all awards by Decade - horizontal, stacked, with proportion values:
figure5B <- BPindiv %>% 
  group_by(Decade) %>%
  count(Gender) %>%
  ggplot(aes(x = Decade, y = n, fill = Gender)) +
  geom_bar(aes(fill = Gender), stat = "identity", position = "fill") + # use , position = "fill" for proportion plot
  coord_flip() + 
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) +
  theme_bw() +
  theme(legend.position = "none", legend.box = "horizontal", axis.text = element_text(size = 10)) +
  labs(fill = "Awardee gender:") +
  labs(x = "Decade", y = "Awardee proportion")  
```

Gender plot by SA
```{r}
## plot for a all awards by SA - not stacked, with count values:
BPindiv %>% 
  group_by(award_SA) %>%
  count(Gender) %>%
  ggplot(aes(x = reorder(award_SA, desc(award_SA)), y = n, fill = Gender)) +
  geom_bar(aes(fill = Gender), stat = "identity", position = "fill") + # use , position = "fill" for proportion plot
  coord_flip() + 
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) +
  theme_bw() +
  theme(legend.position="top", legend.box = "horizontal", axis.text = element_text(size = 10)) +
  labs(fill = "Awardee gender:") +
  labs(x = "Scimago Subject Area", y = "Awardee proportion")  
```

Gender plot by SA and Decade
```{r}
## plot for a all awards by SA and Decade - not stacked, with count values:
BPindiv %>% 
  group_by(award_SA, Decade) %>%
  count(Gender) %>%
  ggplot(aes(x = reorder(award_SA, desc(award_SA)), y = n, fill = Gender)) +
  geom_bar(aes(fill = Gender), stat = "identity", position = position_dodge(0.8), width = 0.8, col = "white") + # use , position = "fill" for proportion plot
  facet_wrap(~Decade, scales = "fixed", nrow = 1, ncol = 3) +
  coord_flip() + 
  scale_fill_manual(values = c("#E69F00", "#56B4E9")) +
  theme_bw() +
  theme(legend.position="top", legend.box = "horizontal", axis.text = element_text(size = 10)) +
  labs(fill = "Awardee gender:") +
  labs(x = "Scimago Subject Area", y = "Awardee count")  
```


### Affiliation country

How many had affiliation info and from where (affiliation_info_source)?
```{r}
length(unique(BPindiv$affiliation_country)) #44 unique country names
table(is.na(BPindiv$affiliation_country)) #45 values missing (out of 1083 = 4%)
table(BPindiv$affiliation_info_source, useNA = "always") #affiliations sources
round(table(BPindiv$affiliation_info_source, useNA = "always")/1058*100,1) #as percentages

#count number of unique countries per decade:
BPindiv %>% 
  filter(!is.na(affiliation_country)) %>% 
  group_by(Decade) %>% 
  summarise(count = n_distinct(affiliation_country))

#count number of unique countries per year:
BPindiv %>% 
  filter(!is.na(affiliation_country)) %>% 
  group_by(award_year) %>% 
  summarise(count = n_distinct(affiliation_country))

#count countries:
BPindiv %>% 
  filter(!is.na(affiliation_country)) %>% 
  count(affiliation_country) %>% 
  arrange(desc(n))

# #count countries - view top 20:
# BPindiv %>% 
#   filter(!is.na(affiliation_country)) %>% 
#   count(affiliation_country) %>% 
#   arrange(desc(n)) %>%
#   filter(n>5) %>%
#   View()

#recode top 10 countries + other
BPindiv$Country10 <- recode(BPindiv$affiliation_country, 
                            "USA" = "USA", 
                            "UK" = "UK", 
                            "Australia" = "Australia", 
                            "China" = "China", 
                            "Germany" = "Germany", 
                            "Canada" = "Canada", 
                            "Japan" = "Japan", 
                            "Netherlands" = "Netherlands", 
                            "Italy" = "Italy", 
                            "France" = "France", 
                            .default = "other")
#table(BPindiv$Country10)

#recode countries with n>5 (20)
#BPindiv$Country20 <- recode(BPindiv$affiliation_country, 
                            # "USA" = "USA", 
                            # "UK" = "UK", 
                            # "Australia" = "Australia", 
                            # "China" = "China", 
                            # "Germany" = "Germany", 
                            # "Canada" = "Canada", 
                            # "Japan" = "Japan", 
                            # "Netherlands" = "Netherlands", 
                            # "Italy" = "Italy", 
                            # "France" = "France", 
                            # "Austria" = "Austria", 
                            # "Spain" = "Spain", 
                            # "Sweden" = "Sweden", 
                            # "Switzerland" = "Switzerland", 
                            # "India" = "India", 
                            # "South Korea" = "South Korea", 
                            # "Brazil" = "Brazil", 
                            # "Singapore" = "Singapore", 
                            # "Taiwan" = "Taiwan",  
                            # "Belgium" = "Belgium",
                            # .default = "other")
#table(BPindiv$Country20)
```

Country affiliation plots overall

```{r}
#all countries as a simple barplot
BPindiv %>% 
  filter(!is.na(affiliation_country)) %>% 
  count(affiliation_country) %>%
  arrange((n)) %>%
  ggplot(aes(x = reorder(affiliation_country, n), y = n)) +
  geom_bar(stat = "identity", position = position_dodge(0.9)) +
  coord_flip()

#top 10 countries - two-colour barplot
BPindiv %>% 
  filter(!is.na(Country10)) %>% 
  count(Country10) %>%
  arrange((n)) %>%
  ggplot(aes(x = reorder(Country10, n), y = n)) +
  geom_bar(aes(fill= Country10 == "other"), stat = "identity", position = position_dodge(0.9)) +
  scale_fill_manual(values = c("#DCDCDCFF", "#000000")) +
  coord_flip() + 
  theme_bw() +
  theme(legend.position="none", axis.text = element_text(size = 10)) +
  labs(x = "Affiliation country", y = "Awardee count")  
```

Country affiliation plot by SA
```{r}
#top 10 countries by SA
BPindiv %>% 
  filter(!is.na(Country10)) %>% 
  count(award_SA, Country10) %>% 
  ggplot(aes(y = reorder(award_SA, desc(award_SA)), x = n, fill = Country)) +
  #geom_bar(stat = "identity")
  geom_bar(aes(fill = Country10), stat = "identity") +
  scale_fill_manual(values = rev(c("#F0E442", "#56B4E9", "#000000", "#009E73", "#9D7660FF", "#0072B2", "#D55E00", "#FCC66DFF", "#FFBED1FF", "#C3CE3DFF", "#C8133BFF"))) +
  theme_bw() + 
  theme(legend.position="top", axis.text = element_text(size = 10), legend.box = "horizontal", legend.margin = margin()) +
  labs(fill = "Awardee affiliation country:") +
  labs(x = "Scimago Subject Area", y = "Awardee count")  

#ggsave(here("plots", "awardee_country_SA_v1.png"), width = 18, height = 8, units = "cm", dpi = "retina")
#ggsave(here("plots", "awardee_country_SA_v1.pdf"), width = 18, height = 8, units = "cm")
```

Country affiliation plot by decade
```{r}
#top 10 countries by Decade - horizontal, stacked, with count values
figure5C <- BPindiv %>% 
  filter(!is.na(Country10)) %>% 
  count(Decade, Country10) %>% 
  ggplot(aes(y = Decade, x = n, fill = Country10)) +
  geom_bar(aes(fill = Country10), stat = "identity") + # use , position = "fill" for proportion plot
  scale_fill_manual(values = rev(c("#F0E442", "#56B4E9", "#000000", "#009E73", "#9D7660FF", "#0072B2", "#D55E00", "#FCC66DFF", "#FFBED1FF", "#C3CE3DFF", "#C8133BFF"))) +
  theme_bw() +
  theme(legend.position="top", legend.text = element_text(size = 8), legend.title = element_text(size = 8),
        axis.text = element_text(size = 10), legend.box = "horizontal", legend.margin = margin()) +
  guides(fill = guide_legend(nrow = 2, byrow = TRUE, reverse = TRUE)) + 
  labs(fill = "Awardee affiliation country:") +
  labs(y = "Decade", x = "Awardee counts")  

#top 10 countries by Decade - horizontal, stacked, with proportion values
figure5D <- BPindiv %>% 
  filter(!is.na(Country10)) %>% 
  count(Decade, Country10) %>% 
  ggplot(aes(y = Decade, x = n, fill = Country10)) +
  geom_bar(aes(fill = Country10), stat = "identity", position = "fill") + # use , position = "fill" for proportion plot
  scale_fill_manual(values = rev(c("#F0E442", "#56B4E9", "#000000", "#009E73", "#9D7660FF", "#0072B2", "#D55E00", "#FCC66DFF", "#FFBED1FF", "#C3CE3DFF", "#C8133BFF"))) +
  theme_bw() +
  theme(legend.position = "none", axis.text = element_text(size = 10), legend.box = "horizontal", legend.margin = margin()) +
  labs(fill = "Awardee affiliation country:") +
  labs(y = "Decade", x = "Awardee proportion")  
```

Country affiliation plot by decade and by SA
```{r}
#top 10 countries by SA and decade
BPindiv %>% 
  filter(!is.na(Country10)) %>% 
  count(award_SA, Decade, Country10) %>% 
  ggplot(aes(y = reorder(award_SA, desc(award_SA)), x = n, fill = Country10)) +
  #geom_bar(stat = "identity")
  geom_bar(aes(fill = Country10), stat = "identity") + # use , position = "fill" for proportion plot
  scale_fill_manual(values = rev(c("#F0E442", "#56B4E9", "#000000", "#009E73", "#9D7660FF", "#0072B2", "#D55E00", "#FCC66DFF", "#FFBED1FF", "#C3CE3DFF", "#C8133BFF"))) +
    facet_wrap(~Decade, scales = "fixed", nrow = 1, ncol = 3) +
  theme_bw() + 
  theme(legend.position="bottom", axis.text = element_text(size = 10), legend.box = "horizontal", legend.margin = margin()) +
  labs(fill = "Awardee affiliation country:") +
  labs(x = "Awardee count", y = "Scimago Subject Area")  

#ggsave(here("plots", "awardee_country_SA_Decade_v1.png"), width = 18, height = 8, units = "cm", dpi = "retina")
#ggsave(here("plots", "awardee_country_SA_Decade_v1.pdf"), width = 18, height = 8, units = "cm")
```

Combine 4 panels and save:
```{r}
#assemble the panels using patchwork package
figure5 <- figure5A / figure5B / figure5C / figure5D + 
  plot_layout(ncol = 1, nrow = 4) +
  plot_annotation(tag_levels = "A")
#ggsave(plot = figure5, here("plots", "Fig5ABCD_gender_countries_v0.png"), width = 18, height = 14, units = "cm", dpi = "retina", scale = 1.2)
#ggsave(plot = figure5, here("plots", "Fig5ABCD_gender_countries_v0.pdf"), width = 18, height = 14, units = "cm", scale = 1.2)
```

### Country productivity context

```{r}
COprod <- read_csv(here("data", "scimagojr country rank 2021.csv"), skip = 0) #load data

#top10 contries
COprod$Country %in% unique(BPindiv$Country10) %>% sum() #check overlap - 8
setdiff(unique(BPindiv$Country10), COprod$Country) #missing: "United States" and "United Kingdom"
COprod$Country <-  gsub("United States", "USA", COprod$Country)  #replace with matching name
COprod$Country <-  gsub("United Kingdom", "UK", COprod$Country)  #replace with a matching name
#all countries
COprod$Country %in% unique(BPindiv$affiliation_country) %>% sum() #check overlap - 40 
setdiff(unique(BPindiv$affiliation_country), COprod$Country)  #missing:  "Vietnam"  "UAE"     "Russia" 
COprod$Country <-  gsub("Viet Nam", "Vietnam", COprod$Country)  #replace with matching name
COprod$Country <-  gsub("United Arab Emirates", "UAE", COprod$Country)  #replace with matching name
COprod$Country <-  gsub("Russian Federation", "Russia", COprod$Country)  #replace with a matching name

## Plot for all countries
#recode top 10 countries + other
COprod$Country_affil <- recode(COprod$Country, 
                            "USA" = "USA", 
                            "UK" = "UK", 
                            "Australia" = "Australia", 
                            "China" = "China", 
                            "Germany" = "Germany", 
                            "Canada" = "Canada", 
                            "Japan" = "Japan", 
                            "Netherlands" = "Netherlands", 
                            "Italy" = "Italy", 
                            "France" = "France", 
                            .default = "other")
#table(COprod_affil$Country_affil)
names(COprod)


## Plot productivity of top 10 countries and other - color productivity (Documents) likefor Countries that are in BPindiv data
COprod %>% 
  ggplot(aes(x = 1, y = Documents, fill = Country_affil)) + #reorder(Country_affil, desc(Documents))
  geom_bar(stat = "identity", position = "fill") +
  coord_flip() + 
  #geom_bar(aes(fill = Country_affil), stat = "identity", position = "fill") +
  scale_fill_manual(values = rev(c("#F0E442", "#56B4E9", "#000000", "#009E73", "#9D7660FF", "#0072B2", "#D55E00", "#FCC66DFF", "#FFBED1FF", "#C3CE3DFF", "#C8133BFF"))) +
  theme_bw() + 
  theme(legend.position="top", axis.text = element_text(size = 10), legend.box = "horizontal", legend.margin = margin()) +
  labs(x = "Countries", y = "Documents", fill = "Awardee affiliation country:") + 
  scale_x_discrete(labels = NULL)  #used to remove vertical labels, also breaks = NULL


# ## Plot just for countries matchng BPindiv$affiliation_country
# #reduce productivity dataframe to match affiliation_country:
# COprod %>% filter(Country %in% unique(BPindiv$affiliation_country)) -> COprod_affil
# 
# #recode top 10 countries + other
# COprod_affil$Country_affil <- recode(COprod_affil$Country, 
#                             "USA" = "USA", 
#                             "UK" = "UK", 
#                             "Australia" = "Australia", 
#                             "China" = "China", 
#                             "Germany" = "Germany", 
#                             "Canada" = "Canada", 
#                             "Japan" = "Japan", 
#                             "Netherlands" = "Netherlands", 
#                             "Italy" = "Italy", 
#                             "France" = "France", 
#                             .default = "other")
# #table(COprod_affil$Country_affil)
# names(COprod_affil)
# 
# #productivity of top 10 countries and other
# COprod_affil %>% 
#   ggplot(aes(x = 1, y = Documents, fill = Country_affil)) + #reorder(Country_affil, desc(Documents))
#   geom_bar(stat = "identity", position = "fill") +
#   coord_flip() + 
#   #geom_bar(aes(fill = Country_affil), stat = "identity", position = "fill") +
#   scale_fill_manual(values = rev(c("#F0E442", "#56B4E9", "#000000", "#009E73", "#9D7660FF", "#0072B2", "#D55E00", "#FCC66DFF", "#FFBED1FF", "#C3CE3DFF", "#C8133BFF"))) +
#   theme_bw() + 
#   theme(legend.position="top", axis.text = element_text(size = 10), legend.box = "horizontal", legend.margin = margin()) +
#   labs(x = "Countries", y = "Documents", fill = "Awardee affiliation country:") + 
#   scale_x_discrete(labels = NULL)  #used to remove vertical labels, also breaks = NULL
```
Figure SX.  



### First names

What are the most common first names of the past award winners?
```{r}
BPindiv$first_names <- word(BPindiv$awardee_name, 1) #extract first word
#length(unique(BPindiv$first_names)) #815 unique first names, note some are initials

#count number of unique first names per decade:
BPindiv %>% 
  filter(!is.na(first_names)) %>% 
  #group_by(Decade) %>% 
  summarise(count = n_distinct(first_names))

# #count number of unique first names per year:
# BPindiv %>% 
#   filter(!is.na(first_names)) %>% 
#   group_by(award_year) %>% 
#   summarise(count = n_distinct(first_names)) %>% View()


#count first_names - view 16 names with >5 counts (16 names):
BPindiv %>% 
   #filter(!is.na(first_names)) %>% 
   count(first_names) %>% 
   arrange(desc(n)) %>%
   filter(n > 5) 

#plot first names that appear more than 5 times
BPindiv %>% 
  #filter(!is.na(first_names)) %>% 
  count(first_names) %>% 
  arrange(desc(n)) %>%
  filter(n > 5) %>%
  ggplot(aes(x = reorder(first_names, n), y = n)) +
  geom_bar(stat = "identity", position = position_dodge(0.9)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Winners first name", y = "Count")   
```


### Affiliation institutions

What are the most common affiliation institutions of the past award winners?
```{r}
#length(unique(BPindiv$affiliation_institution)) #672 unique first names, note some require cleaning from extra information after ,
BPindiv$institution <- gsub(",.*", "", BPindiv$affiliation_institution) #remove everything after first comma
#length(unique(BPindiv$institution)) #581

# #count number of unique first names per decade:
# BPindiv %>% 
#   filter(!is.na(institution)) %>% 
#   group_by(Decade) %>% 
#   summarise(count = n_distinct(institution))

# #count number of unique first names per year:
# BPindiv %>% 
#   filter(!is.na(institution)) %>% 
#   group_by(award_year) %>% 
#   summarise(count = n_distinct(institution)) %>% View()

# #count institutions - view names with >5 counts (16 names):
# BPindiv %>% 
#    filter(!is.na(institution)) %>% 
#    count(institution) %>% 
#    arrange(desc(n)) %>%
#    filter(n > 5) 

#plot first names that appear more than 5 times
BPindiv %>% 
  filter(!is.na(institution)) %>% 
  count(institution) %>% 
  arrange(desc(n)) %>%
  filter(n > 5) %>%
  ggplot(aes(x = reorder(institution, n), y = n)) +
  geom_bar(stat = "identity", position = position_dodge(0.9)) +
  coord_flip() +
  theme_bw() +
  labs(x = "Winners affiliation institution", y = "Count")   
```
Figure SX.  


## Cash and perks for the winners

Award descriptions - cash award mentioned?

```{r}
#table(BPdata$Award_cash) #103 no, 111 yes

figure6A <- BPdata %>% 
    mutate(Award_cash = factor(Award_cash, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    mutate(Award_cash = recode(Award_cash, 'no' = 'no', 'yes' = 'yes', 'not available' = 'no description')) %>% #change level names
    count(Award_cash) %>%
    ggplot(aes(x = 1, y = n, fill = Award_cash)) + 
    geom_col(width = 1, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks = c(0,50,100, 150, 200, 250)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Cash", y = "Award count", fill = "Cash award mentioned:") + 
    scale_x_discrete(labels = NULL) + #used to remove vertical labels, also breaks = NULL
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Award descriptions - cash award mentioned across SA:

```{r}
#table(BPdata$Scimago_Subject_Area, BPdata$Award_cash) #as a table by SA

BPdata %>% 
    mutate(Award_cash = factor(Award_cash, levels = (c("no", "not available", "yes")))) %>% #reorder value levels
    mutate(Award_cash = recode(Award_cash, 'no' = 'no', 'yes' = 'yes', 'not available' = 'no description')) %>% #change level names
    count(Scimago_Subject_Area, Award_cash) %>%
    ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = n, fill = Award_cash)) + 
    geom_col(width = 0.8, position = position_stack(reverse = TRUE)) +
    coord_flip() +
    scale_y_continuous(breaks=c(0,5,10)) +
    theme_classic() + 
    scale_fill_manual(values = c("#FA8072", "#E5E5E5", "#C1FFC1")) +
    labs(x = "Scimago Subject Area", y = "Award count", fill = "Cash award mentioned:") + 
    theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Award descriptions - cash award amount?

```{r}
#table(!is.na(BPdata$Award_cash_max_USD_pperson)) #97 values available
#table(!is.na(BPdata$Award_cash_max_USD_pperson), BPdata$Award_individual) #of 97 values available, 40 are for individual awards

#plot overall - histogram
figure6B <- BPdata %>% 
  filter(!is.na(Award_cash_max_USD_pperson)) %>%
  ggplot(aes(y = Award_cash_max_USD_pperson)) + 
  geom_histogram(binwidth = 1000, fill = "grey60", col = "white") +
  coord_flip() +
  theme_bw() + 
  labs(y = "Award cash max. USD/person", x = "Award count") + 
  scale_y_continuous(breaks = c(seq(0, 30000, by = 5000))) +
  theme(legend.position = "none", axis.title.x = element_text(size = 10))


#Plot by SA 
BPdata %>% 
  filter(!is.na(Award_cash_max_USD_pperson)) %>%
  ggplot(aes(x = reorder(Scimago_Subject_Area, desc(Scimago_Subject_Area)), y = Award_cash_max_USD_pperson)) + 
  geom_beeswarm(color = "grey30", alpha = 0.5) +
  coord_flip() +
  theme_bw() + 
  labs(y = "Award cash max. USD/person", x = "Scimago Subject Area") + 
  theme(legend.position = "none", axis.title.x = element_text(size = 10))
```



## Text mining of Comment_on_the_award_cash

Comment_on_the_award_cash - wordcloud of frequencies all words.   

```{r}
#Using packages tidytext and stopwords
Comment_on_the_award_cash_txt <- tibble(txt = tolower(BPdata$Comment_on_the_award_cash))
Comment_on_the_award_cash_txt <- Comment_on_the_award_cash_txt %>% unnest_tokens(output = word, input = txt, token = "words", to_lower = TRUE) #restructure all descriptions as one-token-per-row format
Comment_on_the_award_cash_txt <- Comment_on_the_award_cash_txt %>% anti_join(get_stopwords()) #remove stop words from library(stopwords) 
Comment_on_the_award_cash_txt$word <- tokenize_word_stems(Comment_on_the_award_cash_txt$word) #make all word stems lowercase
word.freq <- Comment_on_the_award_cash_txt %>% count(word, sort = TRUE) #count words
word.freq$word <-  gsub("[[:digit:]]", "", word.freq$word)  #remove numbers
word.freq$word <- gsub("[[:punct:][:blank:]]+", " ", word.freq$word) #remove punctuation
word.freq <-  word.freq %>% drop_na() %>% filter(word != "")

## plot wordcloud using library(ggwordcloud) for top 100 words
set.seed(111)
figure6C <- word.freq %>%
  top_n(50) %>%
  ggplot() + 
  geom_text_wordcloud_area(aes(label = word, size = n), eccentricity = 0.2, shape = "square") +
  #scale_size_area(max_size = 10) +
  theme_minimal() +
  scale_color_gradient(low = "#CCCCCC", high = "#1A1A1A") +
  theme(plot.background = element_rect(fill = "#FFFFFF", colour = "#FFFFFF")) #Ppreventing transparent background in png

# figure6C <- word.freq %>% with(wordcloud(word, n, max.words = 100, random.order = FALSE, rot.per = 0, colors = brewer.pal(12, "Paired")))
```

## Figure 6

Combine 3 panels and save:
```{r}
#assemble the panels using patchwork package
figure6 <- figure6A / (figure6B + figure6C) +
  plot_layout(nrow = 2, heights = c(1, 4)) +
  plot_annotation(tag_levels = "A")
#ggsave(plot = figure6, here("plots", "Fig6ABC_perks_v0.png"), width = 18, height = 8, units = "cm", dpi = "retina", scale = 1.2)
#ggsave(plot = figure6, here("plots", "Fig6ABC_perks_v0.pdf"), width = 18, height = 8, units = "cm", scale = 1.2)
```


Count mentions of specific words (stemmed) in Comment_on_the_award_cash:

```{r}
#create list of specific words (stemmed) to count within strings
specific.words2 <- c("certificate", "grant", "attend", "expens", "plaque", "talk", "invit", "registr", "meet", "conference", "member", "travel", "subscr", "board", "editor", "ticket", "article", "free", "ceremon", "congress")

#prepare award descriptions as a single lowercase string
descriptions2 <- BPdata %>% 
  filter(!is.na(Comment_on_the_award_cash)) %>% 
  select(Comment_on_the_award_cash) %>% 
  tolower() #single lowercase string

#sum of all mentions for each word
specific.words.mentions2 <- specific.words2 %>%
  map_int(~ str_count(tolower(descriptions2), .x))

#prepare award descriptions while keeping them separate for each award
descriptions3 <- tolower(BPdata$Comment_on_the_award_cash) #vector of lowercase strings

#sum of mentions per award for each word (counts only one mention per award)
specific.words.mentions3 <- specific.words2 %>%
  map_int(~ sum(str_detect(descriptions3, .x), na.rm = TRUE))

# ## doing the same as above, but manually:
# #count all mentions of words(parts) individually, e.g.:
# sum(str_count(tolower(BPdata$Comment_on_the_award_cash), "certificate"), na.rm = TRUE)
# #counting once per award, e.g. 
# sum(str_detect(BPdata$Comment_on_the_award_cash, "certificate"), na.rm = TRUE)
```


Plot frequencies of specific words - all mentions in cash descriptions.  
```{r}
words.df <- tibble(Words = specific.words2, 
                            Count_all = specific.words.mentions2,
                            Count_once = specific.words.mentions3)

words.df %>%
    ggplot(aes(x = reorder(Words, Count_all), y = Count_all)) + 
    geom_col(width = 0.8, fill = "#838B83") +
    coord_flip() +
    scale_y_continuous(breaks = c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55), limits = c(0, 55)) +
    theme_bw() + 
    labs(x = "Word stem", y = "Count of all mentions") + 
    theme(legend.position = "none", axis.title.x = element_text(size = 10))
```

Plot frequencies of specific words - first mentions in cash descriptions.  
```{r}
words.df %>%
    ggplot(aes(x = reorder(Words, Count_all), y = Count_once)) + 
    geom_col(width = 0.8, fill = "#C1CDC1") +
    coord_flip() +
    scale_y_continuous(breaks = c(0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55), limits = c(0, 55)) +
    theme_bw() + 
    labs(x = "Word stem", y = "Count of first mention per award") + 
    #scale_x_discrete(labels = NULL) + labs(x = "")  + #used to remove vertical labels, also breaks = NULL
    theme(legend.position = "none", axis.title.x = element_text(size = 10))
```



Individual winners data - presence of a personal profile?

```{r}
#note; based on individual winners data

#table(BPindiv$awardee_profile_shown, useNA = "always")

#plot overall
figure7A <- BPindiv %>% 
  mutate(awardee_profile_shown = factor(awardee_profile_shown, levels = (c("yes", "no")))) %>% #reorder value levels
  group_by(award_year) %>%
  count(awardee_profile_shown) %>%
  ggplot(aes(x = award_year, y = n, fill = awardee_profile_shown)) + 
  geom_bar(aes(fill = awardee_profile_shown), stat = "identity") + # use , position = "fill" for proportion plot
  scale_fill_manual(values = c("#C1FFC1", "#FA8072")) +
  theme_bw() + 
  labs(x = "Year", y = "Winner count", fill = "Winner's profile shown") + 
  theme(legend.position = "top", axis.title.x = element_text(size = 10))
```

Individual winners data - presence of a personal photo?

```{r}
#table(BPindiv$awardee_photo_shown, useNA = "always")

#plot overall
figure7B <- BPindiv %>% 
  mutate(awardee_photo_shown = factor(awardee_photo_shown, levels = (c("yes", "no")))) %>% #reorder value levels
  group_by(award_year) %>%
  count(awardee_photo_shown) %>%
  ggplot(aes(x = award_year, y = n, fill = awardee_photo_shown)) + 
  geom_bar(aes(fill = awardee_photo_shown), stat = "identity") + # use , position = "fill" for proportion plot
  scale_fill_manual(values = c("#C1FFC1", "#FA8072")) +
  theme_bw() + 
  labs(x = "Year", y = "Winner count", fill = "Winner's photo shown") + 
  theme(legend.position = "top", axis.title.x = element_text(size = 10))
```


Combine 2 panels and save:
```{r}
#assemble the panels using patchwork package
figure7 <- figure7A / figure7B +
  plot_layout(ncol = 2, nrow = 1) +
  plot_annotation(tag_levels = "A")
#ggsave(plot = figure7, here("plots", "Fig7AB_perks_v0.png"), width = 18, height = 6, units = "cm", dpi = "retina", scale = 1.2)
#ggsave(plot = figure7, here("plots", "Fig7AB_perks_v0.pdf"), width = 18, height = 6, units = "cm", scale = 1.2)
```



### Statistical models 

## Model individual winners gender across years

Statistical analyses of the gender difference in awardee gender across years - using individual-level data

```{r gender stats years}

#Scale the award_year variable to have the mean of 0 and SD of 1
BPindiv$Award_year_scaled <- scale(BPindiv$award_year)

#table(BPindiv$awardee_gender, useNA = "always")
BPindiv %>% 
  mutate(Gender = case_when(
    endsWith(awardee_gender, "F") ~ 1,
    endsWith(awardee_gender, "M") ~ 0
    )) -> BPindiv
#table(BPindiv$Gender)

#Fit generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):

#without year
model_gender <- glmer(Gender ~ 1+ (1|award_SA) + (1|award_name), family = "binomial", data = BPindiv) #without year as a predictor
summary(model_gender)
plogis(summary(model_gender)$coef[1,1])*100 #calculate % difference between genders at the intercept: 38% female names]]

#with year
model_gender <- glmer(Gender ~ Award_year_scaled + (1|award_SA) + (1|award_name), family = "binomial", data = BPindiv) #with year as a predictor
summary(model_gender)
plogis(summary(model_gender)$coef[1,1])*100 #calculate % difference between genders at the intercept: 37% female names

#use the reports package (Makowski et al. 2021) to summarize the analysis
report::report(model_gender)
```

## Model individual winners online profile across years

Statistical analyses of the gender difference in awardee gender across years - using individual-level data

```{r}
#table(BPindiv$awardee_profile_shown, useNA = "always")
BPindiv %>% 
  mutate(Profile = case_when(
    endsWith(awardee_profile_shown, "yes") ~ 1,
    endsWith(awardee_profile_shown, "no") ~ 0
    )) -> BPindiv

#Fit generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package). NOte: does not work with SA as a random effect:
model_profile <- glmer(Profile ~ Award_year_scaled + (1|award_name), family = "binomial", data = BPindiv) #with year as a predictor
summary(model_profile) #slope 1.11 

#use the reports package (Makowski et al. 2021) to summarize the analysis
report::report(model_profile)
```

## Model individual winners online photo across years

Statistical analyses of the gender difference in awardee gender across years - using individual-level data

```{r}
#table(BPindiv$awardee_photo_shown, useNA = "always")
BPindiv %>% 
  mutate(Photo = case_when(
    endsWith(awardee_photo_shown, "yes") ~ 1,
    endsWith(awardee_photo_shown, "no") ~ 0
    )) -> BPindiv

#Fit generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package). Note: does not work with SA as a random effect:
model_photo <- glmer(Photo ~ Award_year_scaled + (1|award_name), family = "binomial", data = BPindiv) #with year as a predictor
summary(model_photo) #slope 1.18

#use the reports package (Makowski et al. 2021) to summarize the analysis
report::report(model_photo)
```



## Model award characteristics vs. how old are the awards?
NOTE: Using the year of oldest listed past winner as a proxy of award establishement year.  

```{r}
#Scale the Awardee_list_earliest_year variable to have the mean of 0 and SD of 1
BPdata$Awardee_list_earliest_year_scaled <- scale(BPdata$Awardee_list_earliest_year)

#table(!is.na(BPdata$Awardee_list_earliest_year)) # values available

## try logistic regressions with Awardee_list_earliest_year for the following variables:
#Award_individual, Flexible_eligibility, Inclusivity_statement, Assessors_transparency, Award_integrity_mentioned, Process_transparency, Self_nomination, Letter_required, Feedback_availability, Award_contact_provided, Criteria_transparency, Award_impact_metrics_mentioned, Award_impact_metrics_only, Open_science


## Award_individual
#table
table(BPdata$Award_individual, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  mutate(Award_individual_num = recode(Award_individual, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4 %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Award_individual_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Award_individual") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Award_individual <- glmer(Award_individual_num ~ Awardee_list_earliest_year_scaled + (1|Scimago_Subject_Area) + (1|Awarding_society), family = "binomial", data = BPdata4) #with year as a predictor
summary(model_Award_individual) #slope ns
#report::report(model_Award_individual) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Flexible_eligibility
#table
table(BPdata$Flexible_eligibility, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Flexible_eligibility == "yes" | Flexible_eligibility == "no") %>%  
  mutate(Flexible_eligibility_num = recode(Flexible_eligibility, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4 %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Flexible_eligibility_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Flexible_eligibility") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
#model_Flexible_eligibility <- glmer(Flexible_eligibility_num ~ Awardee_list_earliest_year_scaled + (1|Scimago_Subject_Area) + (1|Awarding_society), family = "binomial", data = BPdata4) #with year as a predictor - NOT CONVERGING with random effects included
model_Flexible_eligibility <- glm(Flexible_eligibility_num ~ Awardee_list_earliest_year_scaled, family = "binomial", data = BPdata4) #with year as a predictor, without random effects included
summary(model_Flexible_eligibility) #slope ns
#report::report(model_Flexible_eligibility) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Assessors_transparency
#table
table(BPdata$Assessors_transparency, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Assessors_transparency == "yes" | Assessors_transparency == "no") %>%  
  mutate(Assessors_transparency_num = recode(Assessors_transparency, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4 %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Assessors_transparency_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Assessors_transparency") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Assessors_transparency <- glmer(Assessors_transparency_num ~ Awardee_list_earliest_year_scaled + (1|Scimago_Subject_Area), family = "binomial", data = BPdata4) #with year as a predictor, + (1|Awarding_society) causes "boundary (singular)"
summary(model_Assessors_transparency) #slope ns
#report::report(model_Assessors_transparency) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Award_integrity_mentioned - more likely in older awards!
#table
table(BPdata$Award_integrity_mentioned, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Award_integrity_mentioned == "yes" | Award_integrity_mentioned == "no") %>%  
  mutate(Award_integrity_mentioned_num = recode(Award_integrity_mentioned, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4 %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Award_integrity_mentioned_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Award_integrity_mentioned") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Award_integrity_mentioned <- glmer(Award_integrity_mentioned_num ~ Awardee_list_earliest_year_scaled +  (1|Awarding_society), family = "binomial", data = BPdata4) #with year as a predictor, + (1|Scimago_Subject_Area) causes "boundary (singular)"
summary(model_Award_integrity_mentioned) #slope ns, but close
#report::report(model_Award_integrity_mentioned) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Self_nomination - trend for newer awards
#table
table(BPdata$Self_nomination, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Self_nomination == "yes" | Self_nomination == "no") %>%  
  mutate(Self_nomination_num = recode(Self_nomination, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4  %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Self_nomination_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Self_nomination") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Self_nomination <- glmer(Self_nomination_num ~ Awardee_list_earliest_year_scaled + (1|Scimago_Subject_Area), family = "binomial", data = BPdata4) #with year as a predictor
summary(model_Self_nomination) #slope ns, but trend for newer awards to mention self-nominations
#report::report(model_Self_nomination) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Letter_required - less and less recently
#table
table(BPdata$Letter_required, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Letter_required == "yes" | Letter_required == "no") %>%  
  mutate(Letter_required_num = recode(Letter_required, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4  %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Letter_required_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Letter_required") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Letter_required <- glmer(Letter_required_num ~ Awardee_list_earliest_year_scaled + (1|Scimago_Subject_Area) + (1|Awarding_society), family = "binomial", data = BPdata4) #with year as a predictor
summary(model_Letter_required) #slope significant negative -0.5431 - less common over the years
#report::report(model_Letter_required) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Award_contact_provided
#table
table(BPdata$Award_contact_provided, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Award_contact_provided == "yes" | Award_contact_provided == "no") %>%  
  mutate(Award_contact_provided_num = recode(Award_contact_provided, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4  %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Award_contact_provided_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Award_individual") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Award_contact_provided <- glm(Award_contact_provided_num ~ Awardee_list_earliest_year_scaled, family = "binomial", data = BPdata4) #with year as a predictor - but fails with random effects
summary(model_Award_contact_provided) #slope signif negative -0.3314 - less likely recently
#report::report(model_Award_contact_provided) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Criteria_transparency
#table
table(BPdata$Criteria_transparency, useNA = "always")
#filter and make binomial 
BPdata %>% 
filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Criteria_transparency == "yes" | Criteria_transparency == "no") %>%  
  mutate(Criteria_transparency_num = recode(Criteria_transparency, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4 %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Criteria_transparency_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Criteria_transparency") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Criteria_transparency <- glm(Criteria_transparency_num ~ Awardee_list_earliest_year_scaled, family = "binomial", data = BPdata4) #with year as a predictor
summary(model_Criteria_transparency) #slope ns 
#report::report(model_Criteria_transparency) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Award_impact_metrics_mentioned - mostly last 10 years
#table
table(BPdata$Award_impact_metrics_mentioned, useNA = "always")
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Award_impact_metrics_mentioned == "yes" | Award_impact_metrics_mentioned == "no") %>%  
  mutate(Award_impact_metrics_mentioned_num = recode(Award_impact_metrics_mentioned, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4 %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Award_impact_metrics_mentioned_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Award_impact_metrics_mentioned") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Award_impact_metrics_mentioned <- glmer(Award_impact_metrics_mentioned_num ~ Awardee_list_earliest_year_scaled + (1|Awarding_society), family = "binomial", data = BPdata4) #with year as a predictor
summary(model_Award_impact_metrics_mentioned) #slope signif 4.930 - recently mentioned more often
#report::report(model_Award_impact_metrics_mentioned) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Award_impact_metrics_only - seem to be from the last 5 years!!
#table
table(BPdata$Award_impact_metrics_only, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Award_impact_metrics_only == "yes" | Award_impact_metrics_only == "no") %>%  
  mutate(Award_impact_metrics_only_num = recode(Award_impact_metrics_only, yes = 1, no = 0)) -> BPdata4
#plot
BPdata4 %>% 
  ggplot(aes(x = Awardee_list_earliest_year, y = Award_impact_metrics_only_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Award_impact_metrics_only") +
  theme_minimal() 
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Award_impact_metrics_only <- glm(Award_impact_metrics_only_num ~ Awardee_list_earliest_year_scaled, family = "binomial", data = BPdata4) #with year as a predictor, fails with random effects
summary(model_Award_impact_metrics_only) #slope signif 3.782 - more common recently
#report::report(model_Award_impact_metrics_only) #use the reports package (Makowski et al. 2021) to summarize the analysis


## Open_science
#table
table(BPdata$Open_science, useNA = "always")
#filter and make binomial 
BPdata %>% 
  filter(!is.na(Awardee_list_earliest_year)) %>% 
  filter(Open_science == "yes" | Open_science == "no") %>%  
  mutate(Open_science_num = recode(Open_science, yes = 1, no = 0))  -> BPdata4
#plot
BPdata4 %>%
  ggplot(aes(x = Awardee_list_earliest_year, y = Open_science_num)) + 
  geom_point(alpha = 0.2) + 
  stat_smooth(method = "glm", method.args = list(family = binomial), se = TRUE) +
  xlab("Year of first listed awardee") + 
  ylab("Probability of Open_science") +
  theme_minimal()
#model - fit a generalised mixed model with binomial error family and with logit link function, award as a random effect (using glmer from lme4 package):
model_Open_science <- glm(Open_science_num ~ Awardee_list_earliest_year_scaled, family = "binomial", data = BPdata4) #with year as a predictor, fails with random effects
summary(model_Open_science) #slope ns
#report::report(model_Open_science) #use the reports package (Makowski et al. 2021) to summarize the analysis
```

Table of logistic regression results?
## try logistic regressions against Awardee_list_earliest_year for the following variables:
#Award_individual, Flexible_eligibility, Inclusivity_statement, Assessors_transparency, Award_integrity_mentioned, Process_transparency, Self_nomination, Letter_required, Feedback_availability, Award_contact_provided, Criteria_transparency, Award_impact_metrics_mentioned, Award_impact_metrics_only, Open_science

```{r eval = FALSE}
report::report_effectsize(model_Award_impact_metrics_mentioned)
report::report_effectsize(model_Open_science)

r <- report::report(model_Open_science)
r <- report::report_table(model_Open_science)
r <- report::report_model(model_Open_science)
r
str(r)
summary(r)
names(as.data.frame(r))

str(model_Award_individual)
report::report(model_Award_individual)$Effects
```

TRY tables based on: https://cran.r-project.org/web/packages/sjPlot/vignettes/tab_mixed.html

```{r}
library(sjPlot)
tab_model(model_Award_individual)
```